general:
  artifacts: 
    - "darbyrecord.br"
    - "results-columns.txt"
  branches:
    ignore:
      - gh-pages

dependencies:
  override:
    - unzip robocode-1.9.2.5-setup.jar

test:
  override:
    - find robots/ -name '*.java' -print0 | xargs -0 javac -classpath "$CLASSPATH":./libs/robocode.jar:./robots -deprecation -g -source 1.6 -encoding UTF-8
    - java -Xmx512M -Dsun.io.useCanonCaches=false -cp libs/robocode.jar robocode.Robocode -battle battles/darby.battle -nodisplay -results results.txt -nosound -record darbyrecord.br
    - cat <(echo "Darby Robocode Battle number $CIRCLE_BUILD_NUM (from commit $CIRCLE_SHA1)") <(column -ts $'\t' results.txt) > results-columns.txt
  post:
    - mkdir ~/results/ && mv darbyrecord.br results-columns.txt ~/results/ && git checkout gh-pages && git pull && cp ~/results/results-columns.txt ~/results/darbyrecord.br . && python imagemaker.py > battlegraphic.svg && git config user.email '@' && git config user.name 'CircleCI' && git add results-columns.txt darbyrecord.br battlegraphic.svg && git commit -m 'Update published battle' && git push && git checkout master && cp ~/results/results-columns.txt ~/results/darbyrecord.br . # so they are still available as artifacts
